upstream appcluster {
<% @upstream_servers.each do |upstream_server| -%>
    server <%= upstream_server.has_key?("ec2") ? upstream_server["ec2"]["hostname"] : upstream_server["ipaddress"] %>:<%= @port %>;
<% end -%>
}

server {
  listen 80;

  server_name load_balancer_test;
  client_max_body_size 200M;

   location /v1 {
            proxy_pass http://appcluster/v1;
            proxy_set_header        X-Real-IP $remote_addr;
            proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header        Host $http_host;
            proxy_read_timeout 8m;

   }
   location / {
            		root   <%=@install_dir%>/<%=@appName%>;
            		index  index.html index.htm;
					error_page 405 = $uri;
					proxy_set_header X-Forwarded-Protocol "http" ;
        	}
}
